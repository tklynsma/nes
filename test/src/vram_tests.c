#include "../../include/vram.h"
#include "../include/test_unit.h"
#include "../include/vram_tests.h"

#include <stdio.h>

char *test_0000_1FFF(void) {
    vrm_init();

    vrm_write(0x0ABC, 0x99);
    ASSERT("0x0000-0x0FFF", vrm_read(0x0ABC) == 0x99);
    ASSERT("0x0000-0x0FFF", vrm_read(0x4ABC) == 0x99);
    ASSERT("0x0000-0x0FFF", vrm_read(0x8ABC) == 0x99);
    ASSERT("0x0000-0x0FFF", vrm_read(0xCABC) == 0x99);

    vrm_write(0x9FFF, 0x88);
    ASSERT("0x0000-0x0FFF", vrm_read(0x1FFF) == 0x88);
    ASSERT("0x0000-0x0FFF", vrm_read(0x2FFF) != 0x88);
    ASSERT("0x0000-0x0FFF", vrm_read(0x5FFF) == 0x88);
    ASSERT("0x0000-0x0FFF", vrm_read(0x9FFF) == 0x88);
    ASSERT("0x0000-0x0FFF", vrm_read(0xDFFF) == 0x88);

    return 0;
}

char *test_2000_2EFF(void) {
    vrm_init();

    vrm_write(0x2000, 0x77);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0x2000) == 0x77);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0x3000) == 0x77);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0x6000) == 0x77);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0x7000) == 0x77);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0xA000) == 0x77);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0xB000) == 0x77);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0xE000) == 0x77);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0xF000) == 0x77);

    vrm_write(0x2EFF, 0x66);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0x2EFF) == 0x66);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0x3EFF) == 0x66);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0x6EFF) == 0x66);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0x7EFF) == 0x66);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0xAEFF) == 0x66);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0xBEFF) == 0x66);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0xEEFF) == 0x66);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0xFEFF) == 0x66);

    return 0;
}

char *test_2F00_2FFF(void) {
    vrm_init();

    vrm_write(0x6F00, 0x55);
    ASSERT("0x2F00-0x3000", vrm_read(0x2F00) == 0x55);
    ASSERT("0x2F00-0x3000", vrm_read(0x3F00) != 0x55);

    return 0;
}

char *test_3000_3F00(void) {
    vrm_init();

    vrm_write(0x3000, 0x77);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0x2000) == 0x77);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0x3000) == 0x77);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0x6000) == 0x77);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0x7000) == 0x77);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0xA000) == 0x77);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0xB000) == 0x77);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0xE000) == 0x77);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0xF000) == 0x77);

    vrm_write(0xFEFF, 0x66);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0x2EFF) == 0x66);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0x3EFF) == 0x66);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0x6EFF) == 0x66);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0x7EFF) == 0x66);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0xAEFF) == 0x66);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0xBEFF) == 0x66);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0xEEFF) == 0x66);
    ASSERT("Mirror 0x2000-0x2EFF", vrm_read(0xFEFF) == 0x66);

    return 0;
}

char *test_3F00_3F1F(void) {
    vrm_init();

    vrm_write(0x7F88, 0x44);
    for (int i = 0; i < 8; i++) {
        for (int j = 0; j < 8; j++) {
            ASSERT("Mirror 0x3F00-0x3F1F", vrm_read(0x3F00 + j * 0x04 + i * 0x20) == 0x44);
            ASSERT("Mirror 0x3F00-0x3F1F", vrm_read(0x7F00 + j * 0x04 + i * 0x20) == 0x44);
            ASSERT("Mirror 0x3F00-0x3F1F", vrm_read(0xBF00 + j * 0x04 + i * 0x20) == 0x44);
            ASSERT("Mirror 0x3F00-0x3F1F", vrm_read(0xFF00 + j * 0x04 + i * 0x20) == 0x44);
        }
    }

    vrm_write(0xBF7F, 0x33);
    for (int i = 0; i < 8; i++) {
        ASSERT("Mirror 0x3F00-0x3F1F", vrm_read(0x3F1F + i * 0x20) == 0x33);
        ASSERT("Mirror 0x3F00-0x3F1F", vrm_read(0x7F1F + i * 0x20) == 0x33);
        ASSERT("Mirror 0x3F00-0x3F1F", vrm_read(0xBF1F + i * 0x20) == 0x33);
        ASSERT("Mirror 0x3F00-0x3F1F", vrm_read(0xFF1F + i * 0x20) == 0x33);
    }

    return 0;
}

char *vrm_tests(void) {
    RUN_TEST( test_0000_1FFF );
    RUN_TEST( test_2000_2EFF );
    RUN_TEST( test_2F00_2FFF );
    RUN_TEST( test_3000_3F00 );
    RUN_TEST( test_3F00_3F1F );

    return 0;
}
